#!/bin/bash
## Usage:  ./hirise.sh 
## This is a self-contained script to scrape the University of Arizona's HiRise imaging experiment FTP archive. it generates a single file (FILES.txt) containing urls for each Mars image in the archive. This makes it easier to programatically access the metadata .LBL files and ultimately, the source images (.jp2).

declare -a DIRECTORIES=('ORB_011200_011299' 'ORB_011300_011399' 'ORB_011400_011499' 'ORB_011500_011599' 'ORB_011600_011699' 'ORB_011700_011799' 'ORB_011800_011899' 'ORB_011900_011999' 'ORB_012000_012099' 'ORB_012100_012199' 'ORB_012200_012299' 'ORB_012300_012399' 'ORB_012400_012499' 'ORB_012500_012599' 'ORB_012600_012699' 'ORB_012700_012799' 'ORB_012800_012899' 'ORB_012900_012999' 'ORB_013000_013099' 'ORB_013100_013199' 'ORB_013200_013299' 'ORB_013300_013399' 'ORB_013400_013499' 'ORB_013500_013599' 'ORB_013600_013699' 'ORB_013700_013799' 'ORB_013800_013899' 'ORB_013900_013999' 'ORB_014000_014099' 'ORB_014100_014199' 'ORB_014200_014299' 'ORB_014300_014399' 'ORB_014400_014499' 'ORB_015800_015899' 'ORB_015900_015999' 'ORB_016000_016099' 'ORB_016100_016199' 'ORB_016200_016299' 'ORB_016300_016399' 'ORB_016400_016499' 'ORB_016500_016599' 'ORB_016600_016699' 'ORB_016700_016799' 'ORB_016800_016899' 'ORB_016900_016999' 'ORB_017000_017099' 'ORB_017100_017199' 'ORB_017200_017299' 'ORB_017300_017399' 'ORB_017400_017499' 'ORB_017500_017599' 'ORB_017600_017699' 'ORB_017700_017799' 'ORB_017800_017899' 'ORB_017900_017999' 'ORB_018000_018099' 'ORB_018100_018199' 'ORB_018200_018299' 'ORB_018300_018399' 'ORB_018400_018499' 'ORB_018500_018599' 'ORB_018600_018699' 'ORB_018700_018799' 'ORB_018800_018899' 'ORB_018900_018999' 'ORB_019000_019099' 'ORB_019100_019199' 'ORB_019200_019299' 'ORB_019300_019399' 'ORB_019400_019499' 'ORB_019500_019599' 'ORB_019600_019699' 'ORB_019700_019799' 'ORB_019800_019899' 'ORB_019900_019999' 'ORB_020000_020099' 'ORB_020100_020199' 'ORB_020200_020299' 'ORB_020300_020399' 'ORB_020400_020499' 'ORB_020500_020599' 'ORB_020600_020699' 'ORB_020700_020799' 'ORB_020800_020899' 'ORB_020900_020999' 'ORB_021400_021499' 'ORB_021500_021599' 'ORB_021600_021699' 'ORB_021700_021799' 'ORB_021800_021899' 'ORB_021900_021999' 'ORB_022000_022099' 'ORB_022100_022199' 'ORB_022200_022299' 'ORB_022300_022399' 'ORB_022400_022499' 'ORB_022500_022599' 'ORB_022600_022699' 'ORB_022700_022799' 'ORB_022800_022899' 'ORB_022900_022999' 'ORB_023000_023099' 'ORB_023100_023199' 'ORB_023200_023299' 'ORB_023300_023399' 'ORB_023400_023499' 'ORB_023500_023599' 'ORB_023600_023699' 'ORB_023700_023799' 'ORB_023800_023899' 'ORB_023900_023999' 'ORB_024000_024099' 'ORB_024100_024199' 'ORB_024200_024299' 'ORB_024300_024399' 'ORB_024400_024499' 'ORB_024500_024599' 'ORB_024600_024699' 'ORB_024700_024799' 'ORB_024800_024899' 'ORB_024900_024999' 'ORB_025000_025099' 'ORB_025100_025199' 'ORB_025200_025299' 'ORB_025300_025399' 'ORB_025400_025499' 'ORB_025500_025599' 'ORB_025600_025699' 'ORB_025700_025799' 'ORB_025800_025899' 'ORB_025900_025999' 'ORB_026000_026099' 'ORB_026100_026199' 'ORB_026200_026299' 'ORB_026300_026399' 'ORB_026400_026499' 'ORB_026500_026599' 'ORB_026600_026699' 'ORB_026700_026799' 'ORB_026800_026899' 'ORB_026900_026999' 'ORB_027000_027099' 'ORB_027100_027199' 'ORB_027200_027299' 'ORB_027300_027399' 'ORB_027400_027499' 'ORB_027500_027599' 'ORB_027600_027699' 'ORB_027700_027799' 'ORB_027800_027899' 'ORB_027900_027999' 'ORB_028000_028099' 'ORB_028100_028199' 'ORB_028200_028299' 'ORB_028300_028399' 'ORB_028400_028499' 'ORB_028500_028599' 'ORB_028600_028699' 'ORB_028700_028799' 'ORB_028800_028899' 'ORB_028900_028999' 'ORB_029000_029099/');

for DIRECTORY in ${DIRECTORIES[@]}; do
    BASE="http://hirise-pds.lpl.arizona.edu/PDS/RDR/ESP"
    SUBDIR=${DIRECTORY};
    wget \
       --user-agent="Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.3) Gecko/2008092416 Firefox/3.0.3" \
       -qO- \
       ${BASE}/${SUBDIR}/ | \
    tr \" \' | sed -nE "s~^[^<]*<a href='([^']+)'.*$~${BASE}/${SUBDIR}/\1~p" >> $SUBDIR.txt && \
    cat ${SUBDIR}.txt | while read LINE; do
       BASE_LEVEL_2=$(echo $LINE | sed -E 's~^(http://.*)/([^/]+)/$~\1~g');
       SUB_LEVEL_2=$(echo $LINE | sed -E 's~^(http://.*)/([^/]+)/$~\2~g');
       echo "${BASE}/${SUBDIR} -------> ${BASE_LEVEL_2}/${SUB_LEVEL_2}";
       wget \
         --user-agent="Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.3) Gecko/2008092416 Firefox/3.0.3" \
         -qO- \
         $LINE | \
      tr \" \' | \
      sed \
         -nE \
         "s~^[^<]*<a href='([^']+)'.*$~${BASE_LEVEL_2}/${SUB_LEVEL_2}/\1~p" >> FILES.txt && \
   done
rm  ${SUBDIR}.txt;
done